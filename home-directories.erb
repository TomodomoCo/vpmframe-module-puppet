##################################
#                                #
#     Create home directories    #
#                                #
##################################

<% if app_stage == "dev" %>
user { "vagrant":
        ensure => present,
        gid => "<%= app_user %>",
        groups => ["<%= app_user %>-homerw","<%= app_group %>", "www-php-loggers"],
        membership => minimum,
}
<% else %>
user { "<%= app_user %>":
	ensure => present,
	gid => "<%= app_group %>",
	groups => ["www-php-loggers","<%= app_user %>-homerw"],
	membership => minimum,
	password => "*", # disable password-based logins entirely
}
<% end %>

file { "/home/<%= app_user %>":
	ensure => directory,
	owner => <%= app_user %>,
	group => <%= app_user %>-homerw,
	<% if app_stage == "dev" %>
	mode => 755,
	<% else %>
	mode => 770,
	<% end %>
}

# bin directory
file { "/home/<%= app_user %>/bin":
        ensure => directory,
        owner => <%= app_user %>,
        group => <%= app_group %>,
        mode => 775,
}

# TODO split out uploads
file { "/home/<%= app_user %>/uploads.<%= site_domain %>":
        ensure => directory,
        owner => <%= app_user %>,
        group => <%= app_group %>,
        mode => 775,
}
